<<dd_version: 1>>

# Rapport sur les comparaisons des bases de données non résumées et le résumé


Nous disposons de différentes sources sur les données du commerce au XVIII ème siècle et nous essayons de tester leur robustesse en les comparant entre elles. 

## Comparaison selon la nature des produits importés/exportés


Nous tentons d'identifier quels sont les produits pour lesquels les valeurs des exportations/importations diffèrent d'une base de donnée à l'autre. Ceci va nous permettre d'identifier ainsi que de quantifier les erreurs dans la retranscriptions des données concernant la valeurs des exportations et des importations. Pour cela nous comparons les valeurs des exportations et des importations provenant d'une source résumée et celles provenant d'une source non résumées.

<<dd_do:quietly>>
if  "`c(username)'" == "paulchagnaud" use "/Users/paulchagnaud/Desktop/bdd courante.dta", clear
if  "`c(username)'" == "guillaumedaudin" use "~/Documents/Recherche/Commerce International Français XVIIIe.xls/Balance du commerce/Retranscriptions_Commerce_France/Données Stata/bdd courante.dta", clear

if  "`c(username)'" == "guillaumedaudin" global dir "~/Répertoires Git/StagePaulChagnaud"
if  "`c(username)'" == "paulchagnaud" global dir "~/StagePaulChagnaud/"

<</dd_do>>

Nous nous intéressons uniquement aux observations de l'année 1789 et nous choisissons d'exclure les observations pour lesquels la France est un partenaire commercial.

<<dd_do:quietly>>
keep if year == 1789
generate base_pas_résumé = 1 if source_type != "Résumé"
replace base_pas_résumé = 0 if source_type == "Résumé"
tab partner_grouping 
drop if partner_grouping == "France"
replace export_import = "Exports" if export_import == "Exportations"
collapse (sum) value, by (base_pas_résumé export_import product_sitc_FR)
sort export_import product_sitc_FR
format value %12.0gc
reshape wide value, i(product_sitc_FR export_import) j(base_pas_résumé)
gen log_value0 = log(value0)
gen log_value1 = log(value1)
<</dd_do>>

### Représentation graphique concernant les importations 

<<dd_do:quietly>>
twoway  (scatter log_value0 log_value1 if export_import=="Imports" & log_value0!=., mlabel(product_sitc_FR)) (line log_value0 log_value0), name(graph3, replace) title("Valeurs résumées VS Valeurs non résumées" " par produit (Imports 1789)") legend(off) xtitle(Source : autre) ytitle(Sources : Résumés) xscale(range(12 20))
graph export "$dir/Valeurs_résumées_VS_Valeurs_non_résumées_par_produit_Imports_1789.png", replace
<</dd_do>>

<<dd_graph>>

Nous constatons que les différentes sources ne semblent pas concorder sur la valeur des importations de nombreux produits. Ceci est particulièrement vrai pour les "Monnaies et métaux précieux" ou encore pour les "Produits du bois, liège, jonc". 

### Représentation graphique concernant les exportations 

<<dd_do:quietly>>
twoway  (scatter log_value0 log_value1 if export_import=="Exports" & log_value0!=., mlabel(product_sitc_FR)) (line log_value0 log_value0), name(graph3, replace)  title("Valeurs résumées VS Valeurs non résumées" " par produit (Exports 1789)") legend(off) xtitle(Sources : autres) ytitle(Source Résumé) xscale(range(12 20))
graph export "$dir/Valeurs_résumées_VS_Valeurs_non_résumées_par_produit_Exports_1789.png", replace
<</dd_do>>

<<dd_graph>>

Malgré une légère amélioration par rapport aux importations, nous constatons que les différentes sources ne semblent pas concorder sur la valeur des exportations de nombreux produits. Ceci est particulièrement vrai pour les "Filés ou tissés de fibre végétale non mélangés" ou encore pour les "Autres filés ou tissés mélangés de fibre végétales dont toiles". 

## Comparaison selon les partenaires 


Nous tentons d'identifier quels sont les partenaires commerciaux pour lesquels les valeurs des exportations/importations diffèrent d'une base de donnée à l'autre. Ceci va nous permettre d'identifier ainsi que de quantifier les erreurs dans la retranscriptions des données concernant la valeurs des exportations et par importations. Pour cela nous comparons les valeurs des exportations et des importations provenant d'une source résumée et celles provenant d'une source non résumées.

Nous nous intéressons uniquement aux observations de l'année 1789 et nous choisissons d'exclure les observations pour lesquels la France est un partenaire commercial. De plus, nous choisissons d'exclure les observations pour lesquels les produits importés sont des "Monnaies et métaux précieux" puisque ce type de bien ne peut être comptabilisé comme faisant parti des échanges commerciaux entre deux pays. 

<<dd_do:quietly>>


if  "`c(username)'" == "paulchagnaud" use "/Users/paulchagnaud/Desktop/bdd courante.dta", clear
if  "`c(username)'" == "guillaumedaudin" use "~/Documents/Recherche/Commerce International Français XVIIIe.xls/Balance du commerce/Retranscriptions_Commerce_France/Données Stata/bdd courante.dta", clear
keep if year == 1789
generate base_pas_résumé = 1 if source_type != "Résumé"
replace base_pas_résumé = 0 if source_type == "Résumé"
tab partner_grouping 
drop if partner_grouping == "France"
replace export_import = "Exports" if export_import == "Exportations"

tab partner_grouping 
drop if product_sitc_FR == "Monnaies et métaux précieux"
replace partner_grouping = "Outre-mers" if partner_grouping == "Afrique" | partner_grouping == "Asie" | partner_grouping == "Amériques"
collapse (sum) value, by (base_pas_résumé export_import partner_grouping)
sort export_import partner_grouping
format value %15.0fc
reshape wide value, i(partner_grouping export_import) j(base_pas_résumé)
gen log_value0 = log(value0)
gen log_value1 = log(value1)
<</dd_do>>

### Représentation graphique concernant les importations 

<<dd_do:quietly>>
twoway  (scatter log_value0 log_value1 if export_import=="Imports" & log_value0!=., mlabel(partner_grouping)) (line log_value0 log_value0), name(graph3, replace)  title("Valeurs résumées VS Valeurs non résumées" " par partenaire (Imports 1789)") legend(off) xtitle(Sources : autres) ytitle(Source : Résumé) xscale(range(14 20)) 
graph export "$dir/Valeurs_résumées_VS_Valeurs_non_résumées_par_partenaire_Imports_1789.png", replace
<</dd_do>>

<<dd_graph>>

Nous constatons que les différentes sources ne semblent concorder sur la valeur des importations de nombreux partenaires commerciaux. Néanmoins les données concernant l'Espagne et l'Allemagne semblent être les moins fiables. 

### Représentation graphique concernant les exportations 

<<dd_do:quietly>>
twoway  (scatter log_value0 log_value1 if export_import=="Exports", mlabel(partner_grouping)) (line log_value0 log_value0), name(graph3, replace) title("Valeurs résumées VS Valeurs non résumées" " par partenaire (Exports 1789)") legend(off) xtitle(Sources : autres) ytitle(Source : Résumé) xscale(range(14 20))
graph export "$dir/Valeurs_résumées_VS_Valeurs_non_résumées_par_partenaire_Exports_1789.png", replace 
<</dd_do>>

<<dd_graph>>

Nous constatons que les différentes sources ne semblent pas concorder sur la valeur des exportations de la plupart des partnaires commerciaux. Ceci est particulièrement vrai pour le Nord, la Hollande et la Flandre. 

## Comparaison selon les produits par partenaire 


Nous tentons d'identifier quels sont les produits par partenaire commercial pour lesquels les valeurs des exportations/importations diffèrent d'une base de donnée à l'autre. Ceci va nous permettre d'identifier ainsi que de quantifier les erreurs dans la retranscriptions des données concernant la valeurs des  exportés et importés. Pour cela nous comparons les valeurs des exportations et des importations provenant d'une source résumée et celles provenant d'une source non résumées.

Nous décidons de nous intéresser uniquement aux observations de l'année 1789 et nous choisissons d'exclure les observations pour lesquels la France est un partenaire commercial. 

<<dd_do:quietly>>
if  "`c(username)'" == "paulchagnaud" use  "/Users/paulchagnaud/Desktop/bdd courante.dta", clear
if  "`c(username)'" == "guillaumedaudin" use "~/Documents/Recherche/Commerce International Français XVIIIe.xls/Balance du commerce/Retranscriptions_Commerce_France/Données Stata/bdd courante.dta", clear

replace export_import = "Exports" if export_import == "Exportations"
keep if year == 1789
generate base_pas_résumé = 1 if source_type != "Résumé"
replace base_pas_résumé = 0 if source_type == "Résumé"
tab partner_grouping 
drop if partner_grouping == "France"
replace export_import = "Exports" if export_import == "Exportations"
gen part_x_prod = product_sitc + " " + partner_grouping
collapse (sum) value, by (base_pas_résumé export_import  part_x_prod product_sitc partner_grouping product_sitc_FR)
sort export_import part_x_prod
format value %12.0gc
reshape wide value, i(export_import part_x_prod) j(base_pas_résumé)
gen log_value0 = log(value0)
gen log_value1 = log(value1)
br
<</dd_do>>

### Représentation graphique concernant les importations 

<<dd_do:quietly>>
twoway  (scatter log_value0 log_value1 if export_import=="Imports") (line log_value0 log_value0), name(graph3, replace)  title("Valeurs résumées VS Valeurs non résumées" " par partenaire et produit (Imports 1789)") legend(off) xtitle(Sources : autres) ytitle(Source : Résumé) /*xscale(log) yscale(log)*/
graph export "$dir/Valeurs_résumées_VS_Valeurs_non_résumées_par_partenaire_et_par_produit_Imports_1789.png", replace
<</dd_do>>

<<dd_graph>>

### Représentation graphique concernant les exportations 

<<dd_do:quietly>>
twoway  (scatter log_value0 log_value1 if export_import=="Exports") (line log_value0 log_value0), name(graph3, replace)  title("Valeurs résumées VS Valeurs non résumées" " par partenaire et produit (Exports 1789)") legend(off) xtitle(Sources : autres) ytitle(Source : Résumé) /*xscale(log) yscale(log)*/
graph export "$dir/Valeurs_résumées_VS_Valeurs_non_résumées_par_partenaire_et_par_produit_Exports_1789.png", replace
<</dd_do>>

<<dd_graph>>

### Classement des produits par partenaire les moins fiables 

À présent nous calculons la différence entre les valeurs des produits par partenaire commercial provenant de la source : Résumé et des autres sources. Puis nous établissons un classement des produits par partenaire commercial pour lesquels la différence de valeurs entre les deux sources est la plus élevée. 

#### Classement des 10 produits par partenaire commercial pour lesquels la différence des log des valeurs (en v.a.) entre les deux sources est la plus importante

<<dd_do:quietly>>
gen diff_value_log = log_value0-log_value1
gen diff_value_log_abs = abs(diff_value_log)
gsort -diff_value_log_abs
format *value* %15.2fc
br if product_sitc !="0b" 
br if product_sitc !="0b" & partner_grouping=="Espagne" 
gsort -diff_value_log_abs
<</dd_do>>
~~~~

<<dd_do:nocommand>>
rename product_sitc Produits
rename partner_grouping Partenaires
rename export_import X_ou_M
rename diff_value_log Différence_en_log
list Produits Partenaire X_ou_M Différence_en_log in 1/20, table string(12) clean  
<</dd_do>>

#### Classement des 10 produits par partenaire commercial pour lesquels la différence des valeurs (en v.a.) entre les deux sources est la plus importante

<<dd_do:quietly>>
gen diff_value_abs =abs(value0-value1) 
gen diff_value = value0-value1  
format *value* %15.2fc 
br if product_sitc !="0b" 
br if product_sitc !="0b"
gsort -diff_value_abs
<</dd_do>>

~~~~

<<dd_do:nocommand>>
rename diff_value Différence 
list Produits Partenaire X_ou_M Différence Différence_en_log in 1/20, table string(12) clean  
<</dd_do>>




















